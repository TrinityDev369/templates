# =============================================================================
# security-headers.conf — HTTP Security Headers
# =============================================================================
# Defense-in-depth security headers for production. These headers instruct
# browsers to enforce security policies on the client side.
#
# Test your headers at: https://securityheaders.com
# =============================================================================

# -----------------------------------------------------------------------------
# Strict-Transport-Security (HSTS)
# -----------------------------------------------------------------------------
# Force HTTPS for 2 years. includeSubDomains covers all subdomains.
# preload allows submission to browser HSTS preload lists.
# WARNING: Only enable preload after confirming ALL subdomains support HTTPS.
add_header Strict-Transport-Security "max-age=63072000; includeSubDomains; preload" always;

# -----------------------------------------------------------------------------
# X-Frame-Options
# -----------------------------------------------------------------------------
# Prevent clickjacking by controlling iframe embedding.
# SAMEORIGIN allows framing only from the same origin.
# Use CSP frame-ancestors for more granular control.
add_header X-Frame-Options "SAMEORIGIN" always;

# -----------------------------------------------------------------------------
# X-Content-Type-Options
# -----------------------------------------------------------------------------
# Prevent MIME-type sniffing. Browser must respect declared Content-Type.
add_header X-Content-Type-Options "nosniff" always;

# -----------------------------------------------------------------------------
# X-XSS-Protection
# -----------------------------------------------------------------------------
# Disabled (set to 0). Modern browsers have deprecated XSS Auditor.
# Content-Security-Policy is the proper defense against XSS.
add_header X-XSS-Protection "0" always;

# -----------------------------------------------------------------------------
# Referrer-Policy
# -----------------------------------------------------------------------------
# Send origin on cross-origin requests, full URL on same-origin.
# Balances analytics needs with user privacy.
add_header Referrer-Policy "strict-origin-when-cross-origin" always;

# -----------------------------------------------------------------------------
# Content-Security-Policy (CSP)
# -----------------------------------------------------------------------------
# Sensible default policy. Customize based on your application's needs.
#
# Current policy:
#   - Scripts: same origin only (no inline, no eval)
#   - Styles: same origin + inline (needed by most frameworks)
#   - Images: same origin + data URIs + HTTPS sources
#   - Fonts: same origin + Google Fonts + data URIs
#   - Connections: same origin + your API endpoints
#   - Frames: none (no embedding of external content)
#   - Base URI: same origin only
#   - Form targets: same origin only
#
# CUSTOMIZE: Add domains your app needs (CDN, analytics, API endpoints).
# Use https://csp-evaluator.withgoogle.com/ to validate your policy.
add_header Content-Security-Policy "default-src 'self'; script-src 'self'; style-src 'self' 'unsafe-inline'; img-src 'self' data: https:; font-src 'self' https://fonts.gstatic.com data:; connect-src 'self'; frame-src 'none'; frame-ancestors 'self'; base-uri 'self'; form-action 'self'; upgrade-insecure-requests" always;

# -----------------------------------------------------------------------------
# Permissions-Policy (formerly Feature-Policy)
# -----------------------------------------------------------------------------
# Restrict access to browser features. Deny all by default, enable as needed.
# Syntax: feature=(allowlist) — empty () means deny to all.
add_header Permissions-Policy "accelerometer=(), autoplay=(), camera=(), cross-origin-isolated=(), display-capture=(), encrypted-media=(), fullscreen=(self), geolocation=(), gyroscope=(), keyboard-map=(), magnetometer=(), microphone=(), midi=(), payment=(), picture-in-picture=(self), publickey-credentials-get=(), screen-wake-lock=(), sync-xhr=(self), usb=(), xr-spatial-tracking=()" always;

# -----------------------------------------------------------------------------
# Cross-Origin Policies
# -----------------------------------------------------------------------------

# Cross-Origin-Opener-Policy — isolate browsing context
add_header Cross-Origin-Opener-Policy "same-origin" always;

# Cross-Origin-Resource-Policy — restrict resource loading
add_header Cross-Origin-Resource-Policy "same-origin" always;
