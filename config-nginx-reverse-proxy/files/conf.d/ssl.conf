# =============================================================================
# ssl.conf — SSL/TLS Configuration
# =============================================================================
# Strong TLS defaults for production. Supports TLS 1.2 and 1.3 only.
# Achieves A+ on SSL Labs when paired with proper certificates.
#
# SETUP:
#   1. Replace certificate paths with your actual cert locations
#   2. Generate DH params: openssl dhparam -out /etc/nginx/ssl/dhparam.pem 4096
#   3. For Let's Encrypt: certbot certonly --webroot -w /var/www/certbot -d YOUR_DOMAIN
# =============================================================================

# -----------------------------------------------------------------------------
# Certificate paths — update these with your actual certificates
# -----------------------------------------------------------------------------
ssl_certificate         /etc/nginx/ssl/fullchain.pem;
ssl_certificate_key     /etc/nginx/ssl/privkey.pem;

# Diffie-Hellman parameter for DHE ciphersuites (generate with openssl dhparam)
ssl_dhparam             /etc/nginx/ssl/dhparam.pem;

# -----------------------------------------------------------------------------
# Protocol versions — TLS 1.2 and 1.3 only (no SSLv3, TLS 1.0, TLS 1.1)
# -----------------------------------------------------------------------------
ssl_protocols TLSv1.2 TLSv1.3;

# -----------------------------------------------------------------------------
# Cipher suites — strong ciphers, server preference
# -----------------------------------------------------------------------------
# TLS 1.3 ciphers are automatically negotiated and cannot be overridden here.
# These ciphers apply to TLS 1.2 connections only.
ssl_ciphers ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-CHACHA20-POLY1305:ECDHE-RSA-CHACHA20-POLY1305:DHE-RSA-AES128-GCM-SHA256:DHE-RSA-AES256-GCM-SHA384;

# Prefer server ciphers over client ciphers
ssl_prefer_server_ciphers off;

# -----------------------------------------------------------------------------
# ECDH curve — use X25519 with P-256 fallback
# -----------------------------------------------------------------------------
ssl_ecdh_curve X25519:secp384r1;

# -----------------------------------------------------------------------------
# Session caching — reduce TLS handshake overhead
# -----------------------------------------------------------------------------
# Shared cache: 10MB holds ~40,000 sessions
ssl_session_cache    shared:SSL:10m;
ssl_session_timeout  1d;

# Disable session tickets (for perfect forward secrecy with TLS 1.2)
# TLS 1.3 has its own ticket mechanism that preserves forward secrecy
ssl_session_tickets off;

# -----------------------------------------------------------------------------
# OCSP Stapling — faster certificate validation for clients
# -----------------------------------------------------------------------------
ssl_stapling         on;
ssl_stapling_verify  on;

# Trusted CA certificate for OCSP stapling verification
# For Let's Encrypt: /etc/letsencrypt/live/YOUR_DOMAIN/chain.pem
ssl_trusted_certificate /etc/nginx/ssl/chain.pem;

# DNS resolver for OCSP stapling (Cloudflare + Google public DNS)
resolver 1.1.1.1 8.8.8.8 valid=300s;
resolver_timeout 5s;

# -----------------------------------------------------------------------------
# Buffer size — optimized for typical web traffic
# -----------------------------------------------------------------------------
ssl_buffer_size 4k;
